#!/usr/bin/env php
<?php

if (file_exists(dirname(__DIR__) . '/vendor/autoload.php')) {
    require_once dirname(__DIR__) . '/vendor/autoload.php';
} else {
    if (file_exists('../vendor/autoload.php')) {
        require_once '../vendor/autoload.php';
    } else {
        // System-wide installation
        if (file_exists('/usr/share/php/Symfony/Component/Console/autoload.php')) {
            require_once '/usr/share/php/Symfony/Component/Console/autoload.php';
            require_once '/usr/share/php/Symfony/Component/Dotenv/autoload.php';
            require_once '/usr/share/php/Symfony/Component/DependencyInjection/autoload.php';
            require_once '/usr/share/php/Symfony/Component/Yaml/autoload.php';
        }

        // AbraFlexi & EaseCore fallback
        spl_autoload_register(function ($class) {
            $prefix = 'VitexSoftware\\AbraflexiCli\\';
            $base_dir = __DIR__ . '/../src/';
            $len = strlen($prefix);
            if (strncmp($prefix, $class, $len) === 0) {
                $relative_class = substr($class, $len);
                $file = $base_dir . str_replace('\\', '/', $relative_class) . '.php';
                if (file_exists($file)) {
                    require $file;
                }
            }
        });
    }
}

use Symfony\Component\Console\Application;
use Symfony\Component\Dotenv\Dotenv;
use VitexSoftware\AbraflexiCli\Command\ListCompaniesCommand;
use VitexSoftware\AbraflexiCli\Command\ListEvidencesCommand;
use VitexSoftware\AbraflexiCli\Command\RecordCommand;

if (file_exists(__DIR__ . '/../.env')) {
    (new Dotenv())->usePutenv()->load(__DIR__ . '/../.env');
}

$application = new Application('AbraFlexi CLI', '0.1.0');

$application->add(new ListCompaniesCommand());
$application->add(new ListEvidencesCommand());
$application->add(new RecordCommand());

$application->run();
